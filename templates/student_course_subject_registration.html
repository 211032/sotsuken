<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>生徒に教科を登録</title>
    <link rel="stylesheet" href="/static/CSS/student_course_registration.css">
</head>
<body>
<form action="/student_course_subject_registration/" method="post">
    {% csrf_token %}
    <h1>生徒に教科を登録</h1>
    {% if students|length == 1 %}
        <p>{{ students.first.name }}を選択中</p>
    {% else %}
        <p>{{ students|length }}名を選択中</p>
    {% endif %}
    <input type="hidden" name="students" id="students" value="{{ students }}">
    <label for="subject-name">
        <textarea rows="1" cols="25" id="subject-name" name="searchBox" placeholder="教科名で検索" onkeyup="filterSubjects()" onkeydown="preventNewLine(event)" 
                  style="resize : none; overflow: hidden;"></textarea>
    </label>
    <table id="subjectTable" style="display: flex;">
        <thead>
            <tr>
                <th>教科名</th>
                <th>教室</th>
                <th>日にち</th>
                <th>何限</th>
            </tr>
        </thead>
        <tbody>
            {% for subject in subjects %}
                <tr>
                    <td class="subject-name">{{ subject.subject_name }}</td>
                    <td class="subject-classroom radio-container">
                        <label for="subject-classroom">
                        <select id="subject-classroom" name="subject_classroom">
                            {% for classroom in classrooms %}
                                <option type="radio" name="subject_classroom" id="subject-classroom"
                                       value="{{ classroom.classroom_id }}" >
                                {{ classroom.classroom_name }}
                            {% endfor %}
                        </select>
                        </label>
                    </td>
                    <td class="subject-date">
                        <label>
                            <input type="date" name="subject_date" id="subject-date">～
                            <input type="date" name="subject_date" id="subject-date">まで
                        </label>
                    </td>
                    <td class="subject-unit">
                        <label for="subject-unit">
                            <select id="subject-unit" name="subject_unit">
                                <option value="1">1限目</option>
                                <option value="2">2限目</option>
                                <option value="3">3限目</option>
                                <option value="4">4限目</option>
                            </select>
                        </label>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table><br>
    <br>
    <input type="submit" class="button registration-button" value="時間割登録">
    <a href="{% url 'teacher_home' %}" class="button logout-button">ホームへ戻る</a>
</form>

<script>
    // 教科のフィルタリング
    function filterSubjects() {
        const input = document.getElementById("subject-name").value.toLowerCase().trim();
        const rows = document.getElementById("subjectTable").getElementsByTagName("tbody")[0].getElementsByTagName("tr");
        const subjectTable = document.getElementById("subjectTable");
        let hasResults = false;

        // 入力が空ならすべて非表示
        if (input === "") {
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = "table-row"; // すべて表示
            }
            subjectTable.style.display = "flex"; // テーブルを表示
            return;
        }

        // 検索結果がない場合は非表示
        for (let i = 0; i < rows.length; i++) {
            const subjectNameCell = rows[i].getElementsByClassName("subject-name")[0];
            if (subjectNameCell) {
                const content = subjectNameCell.textContent || subjectNameCell.innerText;
                const isMatch = content.toLowerCase().indexOf(input) > -1;
                rows[i].style.display = isMatch ? "table-row" : "none";
                if (isMatch) hasResults = true;
            }
        }

        subjectTable.style.display = hasResults ? "table" : "none"; // 結果があればテーブルを表示、なければ非表示
    }
    function preventNewLine(event) {
        // Enterキーを押されたときに改行を防止
        if (event.key === 'Enter') {
            event.preventDefault();
        }
    }
</script>

</body>
</html>
